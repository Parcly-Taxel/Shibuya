"""
Packings of points (or equivalently circles) into a unit square
maximising the minimum separation d. Each function below returns
a pair (d, sequence of points).
Cf. https://erich-friedman.github.io/packing/cirinsqu
and http://hydra.nat.uni-magdeburg.de/packing/csq/csq.html
"""
from mpmath import *

def p2():
    return (sqrt(2), [0, 1+1j])

def p3():
    return (sqrt(6)-sqrt(2), [0, mpc(1,2-sqrt(3)), mpc(2-sqrt(3),1)])

def p4():
    return (1, [0, 1, 1j, 1+1j])

def p5():
    return (sqrt(0.5), [0, 1, 1j, 1+1j, 0.5+0.5j])

def p6():
    return (sqrt(13)/6, [mpc(x/2, y/mpf(3)) for x in (0,1,2) for y in (x%2,2+x%2)])

def p7():
    d = 4-2*sqrt(3)
    return (d, [0, d, d*1j, d*(1+1j), mpc(d/2,1), mpc(1,d/2), 0.95+0.95j])

def p8():
    return (sqrt(2 - sqrt(3)), [bp*z + 0.5+0.5j for z in unitroots(4)
                                                for bp in (0.5+0.5j, (1-sqrt(3))/2)])

def p9():
    return (0.5, [mpc(x,y)/2 for x in (0,1,2) for y in (0,1,2)])

"""
from sympy import *
params = symbols("a b y x d")
ideal = (S("x^2+y^2-d^2"),
         S("(2*x+d-1)^2+b^2-d^2"),
         S("a^2+(1-2*y)^2-d^2"),
         S("(a+d-1)^2+(b+d-1)^2-d^2"),
         S("(x-a-d)^2+(y-1+d)^2-d^2"))
GB = groebner(ideal, params, order="lex")
print(GB)
"""
def p10():
    dp = [1180129, -11436428, 98015844, -462103584, 1145811528,
          -1398966480, 227573920, 1526909568, -1038261808, -2960321792,
          7803109440, -9722063488, 7918461504, -4564076288, 1899131648,
          -563649536, 114038784, -14172160, 819200]
    xp = [4833808384, -18292893696, 231089016320, -1126322897408, 2641176117632,
          -3604472915840, 3142380993216, -1893047603328, 926983988992, -469985292736,
          225222946304, -56978206656, -15097884104, 17327716152, -5236535740,
          336548136, 165929282, -38942194, 2584905]
    d = polyroots(dp, extraprec=50)[0]
    x = polyroots(xp, extraprec=50)[4]
    y = sqrt(d*d - x*x)
    a = sqrt(d*d - (1-2*y)**2)
    b = sqrt((1-2*x) * (2*(d+x)-1))
    return (d, [mpc(*z) for z in ((0,0), (x,y), (2*x,0), (0,2*y), (2*x+d,0),
                                  (a,1), (a+d,1), (1,b), (1,b+d), (a+d,1-d))])

def p11():
    d = polyroots([1, 8, -22, 20, 18, -24, -24, 32, -8])[1]
    x = polyroots([16, -32, 16, 8, -7])[1] * d
    y = polyroots([16, -32, 16, -8, 1])[1] * d
    return (d, [mpc(*z) for z in ((0,0), (0,d), (d,0), (1,1), (1-sqrt(2)*d,1), (1,1-sqrt(2)*d),
                                  (1-d/sqrt(2),1-d/sqrt(2)), (x,y), (y,x), (0.91,0.025), (0.025,0.91))])

def p12():
    return (sqrt(34)/15, [mpc(fraction(x,3), fraction(y+x%2,5))
                          for x in (0,1,2,3) for y in (0,2,4)])

"""
option(prot); LIB "elim.lib";
ring r=(0,s),(b,a,y,x,d),dp; minpoly=s2-3;
ideal I=x2+y2-d2,a2+b2-d2,(2a+d-1)^2+(2y+d-1)^2-d2,(2x-1)^2+(2b+d-1)^2-d2,
        (x-(1-(a+s*b)/2))^2+(y-(1-2*b+(b-s*a)/2))^2-d2;
I=sat(I,d)[1];
poly pd=elim(I,abxy)[1];
pd;
"""
def p13():
    dp = [[0, 864665116641711], [-28104584929111908, 47659330746396264], [-645768516385207920, 1114660079628188624],
          [-271002221507689328, 475367780231855840], [149768958170972320, -252188349821109840], [16368378056297492608, -28371625172339499520],
          [-40884498213224701312, 70824275651796366336], [26436355874572015104, -45777262685375092736], [43275912192017374208, -74972437684294657792],
          [-113150947454306898944, 195987208674775394304], [123266390798296981504, -213498628394498887680], [-76447923840235352064, 132407451118567415808],
          [17244750471993139200, -29868073120995438592], [21010669645192298496, -36390914668133941248], [-31976204717970653184, 55384018697947971584],
          [25006610638992310272, -43312662998256189440], [-13114829814314827776, 22715578710630858752], [4706963012829839360, -8152714665959358464],
          [-1109734524459155456, 1922120126119804928], [155129707824676864, -268692944792322048], [-9771872514211840, 16925399418142720]]
    xp = [[0, 73784756620092672], [539842596297395328, -1605913295417536896], [7649548279968554880, -10234806945572200896],
          [-101918184555224364000, 167525102239286754144], [641333830739022614528, -1090702875060607724832], [-2659372602272398688672, 4570572090402518188512],
          [7771488504603038564480, -13409472436692001524240], [-16663159117033256164168, 28801139619747100254312], [27107560866385811343448, -46893072115504231885992],
          [-34325683395193177037508, 59406798153660548536188], [34404368061616303059628, -59558925568511328332472], [-27509287558718541027184, 47630405389431326784288],
          [17527456045223510456866, -30350741803402788860364], [-8798107223686951373501, 15235922140930525178403], [3391589658274816259101, -5873551105602317787456],
          [-956451470050696868585, 1656417047045976187689], [180345709940951615817, -312329185811717220222], [-19464222788927823607, 33707487455411514249],
          [1395775840746124655, -2416989309515807532], [-360023509218944039, 623542079396343255], [61976449083692325, -107345194733251650]]
    ap = [[0, 2235901715760384], [60574205995728768, -126082435118172288], [-1696161125425460352, 3030870107487473472],
          [11698123941573183456, -20515150730375641376], [-45340880818061884512, 79018331582022385280], [82216046888637149408, -143109156853286167968],
          [-72880964682792091824, 127056231762824542112], [22972231413740749480, -40582382208463716040], [12919760502136984680, -21729310160910330360],
          [-14629683999098483188, 24883952247436017500], [2925984654080788552, -4791097672773392692], [4102943269153386896, -7252409486230078200],
          [-3589076397294650268, 6282906018324080674], [617723127797077571, -1095894459412061093], [492621788137825195, -844629291514062038],
          [-159505178683494885, 273883093024406604], [-60459706781338571, 105257244763333305], [32046567838768767, -55600559431419026],
          [-6644850582641145, 11521181021601304], [2830038050144638, -4902736797205390], [-637851253724384, 1104827687429172]]
    with extraprec(50):
        s = sqrt(3)
        d = polyroots([polyval(z, sqrt(3)) for z in dp], extraprec=50)[0]
        x = polyroots([polyval(z, sqrt(3)) for z in xp], extraprec=50)[0]
        a = polyroots([polyval(z, sqrt(3)) for z in ap], extraprec=50)[0]
        y = sqrt(d*d - x*x)
        b = sqrt(d*d - a*a)
        q = (1-(a+s*b)/2, 1-2*b+(b-s*a)/2)
        return (d, [mpc(*z) for z in ((0,0), (x,y), (2*x,0), (0,2*y), (0,2*y+d), q, (0.37,0.64),
                                      (1,1), (1-a,1-b), (1-2*a,1), (1,1-2*b), (1-2*a-d,1), (1,1-2*b-d))])

def p14():
    d = 2*(4-sqrt(3))/13
    return (d, [mpc(x,y)*d for x in range(3) for y in range(3)] +
               [mpc(*z) for z in ((d*0.5,1), (1,d*0.5), (d*1.5,1), (1,d*1.5), (0.965,0.965))])

def p15():
    d = (1+sqrt(2)-sqrt(3))/2
    cd75 = 1 - d*(sqrt(6)+sqrt(2))/4
    d15 = d*(sqrt(6)-sqrt(2))/4
    points = []
    for x in range(4):
        for y in range(4):
            if x == y == 2:
                continue
            if x == 2:
                px = cd75
                py = d15+d*y if y < 3 else 1-d15
            elif y == 2:
                py = cd75
                px = d15+d*x if x < 3 else 1-d15
            else:
                px = x*d if x < 3 else 1
                py = y*d if y < 3 else 1
            points.append(mpc(px,py))
    return (d, points)

def p16():
    return (mpf(1)/3, [mpc(x,y)/3 for x in range(4) for y in range(4)])

"""
option(prot); LIB "elim.lib";
ring r=0,(a,b,k,d),dp;
ideal I=(d-1/2)^2+a^2-d^2,(a-1/2)^2+(d+1/2-b)^2-d^2,
        (k-1/2)^2+(a/2-b/2)^2-d^2,k^2+(a/2+b/2-d)^2-d^2;
I=sat(I,d*(d-2))[1];
poly pd=elim(I,abk)[1];
pd;
"""
def p17():
    # d^8-4*d^7+6*d^6-14*d^5+22*d^4-20*d^3+36*d^2-26*d+5
    d = polyroots([1, -4, 6, -14, 22, -20, 36, -26, 5])[0]
    a = sqrt(d-0.25)
    b = d+0.5 - sqrt((d-a+0.5) * (d+a-0.5))
    k = sqrt((a+b) * (4*d-a-b)) / 2
    points = [mpc(*z) for z in ((0,0), (d,0), (0,d), (0,2*d), (0,1), (a,d+0.5), (k,(a+b)/2))]
    points = points + [1-conj(z) for z in points] + [mpc(0.5,a), mpc(0.5,b), mpc(0.5,0.99)]
    return (d, points)

def p18():
    pass
"""
dd[18] = sqrt(13) / 12
pd[18] = [[a / 4, b / 6] for a in range(5) for b in range(7) if (a + b + 1) % 2]

coef19d = [242, -1430, -8109, 58704, -78452, -2918, 43315, 39812, -53516, 20592, -2704]
d19 = newton(coef19d, 0.290)
dd[19] = d19
v24x, v24y = -sqrt(3) / 2 * d19, d19 / 2
v25x = (1 - sqrt(3) * d19) / 2
v25y = sqrt(d19 ** 2 - v25x ** 2)
l19 = [[0, 0], [1, 0]] + [[sqrt(3) * d19 + a * v24x + b * v25x, a * v24y + b * v25y] for a in range(3) for b in range(3)]
x15 = sqrt(3) * d19 + 2 * v24x + v25x
y15 = 2 * v24y + 3 * v25y
x14 = 2 * v25x - v24x
y14 = d19 + 2 * v25y + v24y
x18 = x15 + sqrt(d19 ** 2 - (1 - y15) ** 2)
x19 = x14 - sqrt(d19 ** 2 - (1 - y14) ** 2)
l19 += [[x14, y14], [x15, y15], [x18, 1], [x19, 1], [0, d19 + 2 * v25y], [1, d19 + 2 * v25y], [0.03, 0.96], [0.97, 0.96]]
pd[19] = l19

dd[20] = (6 - sqrt(2)) / 16
pd[20] = [[a / 4, b * dd[20] + (3 * sqrt(2) - 2) / 16 * (a % 2)] for a in range(5) for b in range(4)]"""
